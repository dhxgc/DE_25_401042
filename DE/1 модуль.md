
---
## Произведите базовую настройку устройств
---

1. Настройте имена устройств согласно топологии. Используйте полное доменное имя. 
Эта часть является по факту обобщающей для всего 1 модуля. Из необходимого здесь только расчет IP-адресации (внимательно прочитать весь модуль, посмотреть какие условия указаны для IP-сетей и где какие должны находиться), определение того, где какие VLAN'ы будут крутиться

>EcoRouter (имена в соответствии с топологией)
```cisco
hostname HQ-RTR.au-team.irpo
hostname BR-RTR.au-team.irpo
```

> Проверка EcoRouter:

Обновленное имя вы должны увидеть автоматически. Если этого не произошло:
* сохранить конфигурацию - `write memory` или `copy running-config startup-config`
* перезагрузка машины средствами Proxmox или командой `команда`

>Debian-хосты (имена в соответствие с топологией)
```bash 
hostnamectl set-hostname ISP
hostnamectl set-hostname hq-sw.au-team.irpo
hostnamectl set-hostname hq-srv.au-team.irpo
hostnamectl set-hostname hq-cli.au-team.irpo
hostnamectl set-hostname br-srv.au-team.irpo
```

> Проверка Debian:

Чтобы имя обновилось, нужно обновить шелл, в котором мы находимся.
* `exec bash` - 1 способ
* `exit` и снова логинимся - 2 способ

> СКРИН ![[Pasted image 20241031012050.jpg]]

Теперь, после того как мы прочитали задание и настроили хостнеймы - нужно для отчета создать таблицу со всеми адресами в сети. Если в задании четко не указано, что нужно ставить определенный IP - то ставим произвольно, желательно хоть на чем-то основываться, чтобы не запутаться. Пример заполненной таблицы - ниже.

| Имя устройства | Интерфейс          | IP             | Маска           | Шлюз         |
| -------------- | ------------------ | -------------- | --------------- | ------------ |
| ISP            | ens18              | DHCP           |                 |              |
|                | ens20              | 172.16.5.1     | 255.255.255.240 |              |
|                | ens19              | 172.16.4.1     | 255.255.255.240 |              |
| HQ-RTR         | ge0                | 172.16.4.2     | 255.255.255.240 | 172.16.4.1   |
|                | ge1.100 (VLAN 100) | 192.168.100.1  | 255.255.255.192 |              |
|                | ge1.200 (VLAN 200) | 192.168.200.1  | 255.255.255.240 |              |
|                | ge1.999 (VLAN 999) | 192.168.99.1   | 255.255.255.248 |              |
|                | tunnel.0           | 10.0.0.1       | 255.255.255.252 |              |
| HQ-SW          | ovs0               | 192.168.99.2   | 255.255.255.248 |              |
|                | ens18              | in bridge      |                 |              |
|                | ens19              | in bridge      |                 |              |
|                | ens20              | in bridge      |                 |              |
| BR-RTR         | ge0                | 172.16.5.2     | 255.255.255.240 | 172.16.5.1   |
|                | ge1                | 192.168.0.1    | 255.255.255.224 |              |
|                | tunnel.0           | 10.0.0.2       | 255.255.255.252 |              |
| HQ-SRV         | ens18              | 192.168.100.10 | 255.255.255.192 | 192.168.100.1  |
| HQ-CLI         | ens18              | DHCP           | 255.255.255.240 | 192.168.200.1 |
| BR-SRV         | ens18              | 192.168.0.10    | 255.255.255.224 | 192.168.0.1  |
Рисуем схему для отчета, где прямо на топологии указаны адреса, вланы, транки и туннели (рисовать ее желательно по мере настройки, чтобы самим понимать то, что уже было сделано и что осталось)

---
## Настройка ISP
---
> Включение маршрутизации. 

Находим в файле `/etc/sysctl.conf` строку `net.ipv4.ip_forward = 0`. 
Меняем значение на `1`. 
Убираем знак `#`. 
Применяем изменения командой `sysctl -p`. 
Должна вывестись измененная строка.

![](https://lh7-rt.googleusercontent.com/slidesz/AGV_vUda9SCFFrIyzGjm6_YdM5c3BiowHe5n9dKYqezsKiG0gQ5nJau-_LNKpq_gS7QnxV5dSpssBTxHwkdoDDy-K00EFi8Gw0DGBkfYGsqFl_q6LzYxLDIlxNj6tbRatwnSsWDm0QseLQwK6EPceP0vlD0FxIweqUkzPkvXDejTTxuterMzSYEDhlc=s2048?key=mH6UCERT_4MboBn5XpnTXB93)

> Настройка IP адресации

Интерфейс подключенный к интернету должен получать адрес по DHCP. Для этого редактируем файл `/etc/network/interfaces`
Приводим часть с интерфейсами к следующему виду:

```config
allow-hotplug ens18
auto ens18 # Линк в Интернет
iface ens18 inet dhcp

auto ens19 # Линк до HQ-RTR
iface ens19 inet static
address 172.16.4.1/28

auto ens20 # Линк до BR-RTR
iface ens20 inet static
address 172.16.5.1/28
```

Перезагружаем сеть.
`systemctl restart networking`

> Настройка маршрутов.

Маршрут по умолчанию у нас появится вместе с адресом, который нам выдал DHCP, так что нам стоит просто посмотреть, что там выдалось.

Вывести все маршруты (4), о которых знает система.
```bash
ip route
```

 Добавить маршрут по умолчанию, если такого не имеется.
```bash
ip route add default via адрес_шлюза_или_название_интерфейса 
```


> Настройка NAT

Для простоты был взят самый примитивный и быстрый вариант - `iptables`. 

```bash
iptables -t nat - A POSTROUTING -o ens18 -j MASQUREADE
```

Для того, чтобы после перезагрузки настройки не слетели:

```bash
apt install iptables-persistent # Ответить Да, когда спросит
iptables-save > /etc/iptables/rules.v4 # Для сохранения при еще каких-то изменениях таблиц iptables
```

---
## Создание локальных учетных записей
---
> Создание пользователя на HQ-SRV, BR-SRV

Пароль - P@ssw0rd
```bash
adduser sshuser -u 1010 # Указали UID, протыкали интерактивные вопросы
echo 'sshuser ALL=(ALL) NOPASSWD:ALL' > /etc/sudoers.d/sshuser # Разрешили не юзать пароль пользователю sshuser
```
Проверка:
```bash
su - sshuser
sudo whoami
```

> Скрин с тем, что все хорошо
> ![[Pasted image 20241031011855.jpg]]

> Создание пользователя на HQ-RTR, BR-RTR
```cisco
enable
configure terminal
username net_admin
password P@ssw0rd
role admin
activate
```
 Проверка: 
```cisco
# Выйти из всех режимов до окна логина
# Залогиниться под новым пользователем
```

---
## Виртуальный коммутатор

---
В этом пункте имеется несколько способов, которые могли бы быть на экзамене.
1. Виртуальный коммутатор реализован в самой среде виртуализации, где участник должен будет просто указать VLAN'ы, которые присваиваются на порты подключенных машин.

>Скрин из PVE с настройкой VLAN'ов на бридже
>![[Pasted image 20241031012106.jpg]]

1. Коммутатор реализован отдельной машиной. В таком случае, все настраивается как в нашем случае, через консоль машины.

