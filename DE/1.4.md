## Виртуальный коммутатор

1. Для начала стоит создать bridge, который будет объединять все порты, что позволит коммутировать устройства на L2, а также разделить все на VLAN'ы.

```ovs
	ovs-vsctl add-br ovs0
```

2. Накинем VLAN теги на порты во время добавления в bridgel, в соответствии с заданием (HQ-SRV - 100, HQ-CLI - 200, HQ-SW - 999)

```ovs
	ovs-vsctl add-port ens18 trunk=100,200,999 # HQ-net
	ovs-vsctl add-port ens19 tag=100 # SRV-net
	ovs-vsctl add-port ens20 tag=200 # CLI-net
	ovs-vsctl set port ovs0 tag=999 # HQ-net
```
2.1. Конфигурируем `/etc/network/interfaces` следующим образом:
```config
auto ens18
iface ens18 inet manual
auto ens19
iface ens18 inet manual
auto ens20
iface ens18 inet manual
auto ovs0
iface ens18 inet static
address 192.168.99.2/29
gateway 192.168.99.1
```
3. Перезагружаем `OVS` и `ifupdown` (networking), который отвечает за сеть.

```bash
	systemctl restart networking openvswitch-switch
```

Проверяем, что все применилось. Важное замечание - все порты должны быть `UP`, или `UNKONOWN`. Может быть еще что-то, но главное чтобы не DOWN, а также был link-local адрес, который говорит о том, что порт подключен и работает.

> Скрин с тем, что все как указано.

4. Теперь переходим к настройке Router-On-Stick. Про то как он работает - [читаем здесь](https://netacad.sadlab.su/srwe-dl/4.2.1).

4.1. Создаем подинтерфейсы. Назначаем IP-шники. Название интерфейса роли не играет, лучше делать чем-то обоснованные - как в этом примере.

```cisco
HQ-RTR:
en
	conf t
	interface ge1.100
		description "vlan100"
		ip address 192.168.100.1/26
		exit
	interface ge1.200
		description "vlan200"
		ip address 192.168.200.1/28
		exit
	interface ge1.999
		description "vlan999"
		ip address 192.168.99.1/29
		exit

	port ge1
		service-instance ge1/ge1.999
			encapsulation dot1q 999 exact
			rewrite pop 1
			connect ip interface ge1.999
			exit
		service-instance ge1/ge1.200
			encapsulation dot1q 200 exact
			rewrite pop 1
			connect ip interface ge1.200
			exit
		service-instance ge1/ge1.100
			encapsulation dot1q 100 exact
			rewrite pop 1
			connect ip interface ge1.100
			exit
```

